# 七 IO接口

IO接口的目的，就是为了协调好CPU，内存等与外设之间的关系。

CPU等部件，都是高速运转的，如何与外设协调同步，是IO接口要解决的问题。

## 1 概述

由于cpu和内存读取的速度非常快，我们想要和外设达成一种协调，就需要想一些特别的办法。

计算机中引入了**数据缓冲寄存器**，来匹配速度的差异。

面对可能出现的错误情况，还在IO接口中，设计了**状态寄存器**，比如打印机是否完成打印，是否缺纸等。

当然，为了和CPU进行通信，我们还需要一个**控制和定时模块**，从总线上获取命令。

最后呢，我们还会碰到格式不匹配的问题，因此引入**数据格式转换**

### 端口和地址

端口是什么呢？其实就是寄存器。

> 例如数据端口：数据缓冲寄存器

两种编制方式，独立编址和统一编址。

独立编址：很简单，顾名思义就是对每个端口进行独立的编号

1. 此时访问IO端口，就需要特殊的输入输出指令

统一编址：和主存的地址空间，混合到一起，共同编址。把IO端口想象成存储器单元进行编址。

1. 此时想要访问IO接口，只需要统一的访存指令即可

## 2 IO方式

### 程序中断方式

简单来说，就是cpu提前安排好一个时机，去启动外设，此时cpu中断，外设完成数据传输后，cpu再继续运行。

#### 中断屏蔽技术

如果原顺序是ABCD，现在要改为DACB，屏蔽字设置如下：

1. D 1111
2. A 1110
3. C 0110
4. B 0100

D不会被任何打断，A只会被D中断，C则是被D和A中断，B除了自己都会被打断

#### 中断流程

1. 关中断
2. 保存断点
3. 识别中断源
4. 保存现场
5. 中断事件处理
6. 恢复现场
7. 开中断
8. 中断返回

前三条由硬件完成，后面是中断服务完成！！

### DMA方式
